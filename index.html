<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/blob.svg">
    <!-- reset.css ress -->
    <!-- <link rel="stylesheet" href="https://unpkg.com/ress/dist/ress.min.css" /> -->
    <!--Google Fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100;200;300;400;500;600;700;800;900&family=Oswald:wght@200;300;400;500;600;700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Zen+Kaku+Gothic+New:wght@300;400;500;700;900&display=swap"
        rel="stylesheet">
    <!--Font Awesome-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer"
    />
    <style>
        p {
            margin: 0;
        }
        
        body {
            font-family: "Poppins", "Noto Sans JP", sans-serif;
        }
        
        pre.prettyprint {
            font-family: "Poppins", "Noto Sans JP", sans-serif;
            padding: 1em 1em 1em 0 !important;
            border-radius: 12px;
            word-break: break-all;
            white-space: pre-wrap;
        }
        
        pre.prettyprint li {
            list-style-type: decimal !important;
        }
        
        article {
            width: min(1024px, 96%);
            margin: 2em auto 0;
        }
        
        header h1 {
            margin-bottom: 0;
        }
        
        header p {
            margin-top: 2px;
        }
        
        .link {
            display: inline-flex;
            gap: 0.5em;
            vertical-align: text-bottom;
            margin-right: 0.5em;
            align-items: center;
        }
        
        .link img {
            height: 20px;
        }
        
        [src="img/warn.svg"] {
            width: 20px;
            vertical-align: text-top;
            margin-right: 0.2em;
        }
        
        .eyeCatch {
            width: min(550px, 100%);
            height: 100%;
            transform: scale(1);
            transform-origin: right center;
        }
        
        header {
            position: relative;
            background: #585858;
            max-width: 1024px;
            margin: 0 auto;
        }
        
        header::after {
            content: "";
            display: block;
            padding-top: 38%;
        }
        
        .header-inner-left {
            position: absolute;
            top: 0;
            left: 10%;
            height: 100%;
        }
        
        .header-inner-right {
            position: absolute;
            left: 63%;
            top: 50%;
            transform: translate(-50%, -50%);
            mix-blend-mode: difference;
            color: #ffffff;
            font-size: 2.2vw;
            width: min(500px, 45vw);
        }
        
        @media (max-width: 500px) {
            .header-inner-right {
                font-size: 2.8vw;
                width: 58%;
            }
            .header-inner-right h1 {
                line-height: 1;
            }
            .header-inner-left {
                left: 0;
            }
        }
        
        body {
            margin: 0;
        }
        
        @media (min-width: 1024px) {
            .header-inner-right {
                font-size: 24px;
            }
        }
        
        * {
            box-sizing: border-box;
        }
        
        #clip path {
            transform: translate(50%, 50%);
        }
        
        section {
            padding-bottom: 4em;
        }
        
        section:last-of-type {
            padding-bottom: 0;
        }
        
        .step {
            padding-left: 2em;
            text-indent: -2em;
        }
        
        .step * {
            text-indent: 0 !important;
        }
        
        .step .number {
            margin-right: 1em;
        }
        
        .lt {
            text-decoration: line-through;
        }
        
        p:not(.step),
        pre.prettyprint {
            margin-left: 2em;
        }
        
        pre {
            margin-top: 5px;
        }
        
        a:hover {
            opacity: 0.8;
        }
        
        .dotted {
            border: 1px dotted rgb(244, 244, 244);
        }
        
        .list-paragraph {
            padding: 1em 0;
        }
        
        ol.linenums li:nth-of-type(odd) {
            background: #262626 !important;
        }
        
        body {
            background: #262626;
            color: #fff;
        }
        
        .list-paragraph {
            color: coral;
        }
        
        body a {
            color: coral;
        }
        
        @media screen and (max-width: 500px) {
            pre.prettyprint {
                margin-left: 0.5em !important;
            }
        }
        
        .header-inner-right p {
            margin-left: 0;
        }
        
        footer {
            padding: 2em 0 3em;
        }
        
        footer small {
            display: block;
            width: fit-content;
            margin: 0 auto;
            max-width: 90vw;
        }
        
        footer img {
            height: 1em;
            vertical-align: middle;
        }
        
        aside p {
            margin-left: 0 !important;
            text-align: justify;
            word-break: break-all;
        }
        
        aside p a {
            display: block;
            padding: 1em;
            border: 1px solid;
            margin: 1em 0;
            width: fit-content;
            text-decoration: none;
        }
        
        aside p a:hover {
            background: #fff;
        }
        
        aside {
            margin: 2em auto 0;
            width: min(1024px, 96%);
        }
        
        aside h2 i {
            margin-right: 0.5em;
        }
    </style>
    <title>アニメーションするSVGで画像をクリップ</title>
</head>

<body>
    <header>
        <div class="header-inner-left">
            <!-- This is clipPath　(animation mask for view-item) -->
            <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" style="position:absolute;width:0;height:0;">
                    <clipPath id="clip">
                        <path style="transform:translate(50%,50%)">
                            <animate dur="3s" repeatCount="indefinite" attributeName="d" values="M32.5,-47C44,-36.3,56.6,-29.4,63,-18.4C69.4,-7.5,69.5,7.6,63.6,19.1C57.8,30.7,45.9,38.7,34.2,50.9C22.6,63.2,11.3,79.6,-2.6,83.2C-16.6,86.9,-33.2,77.7,-46.9,66.1C-60.7,54.6,-71.6,40.7,-76.2,25.1C-80.8,9.5,-78.9,-7.8,-74.4,-25C-69.9,-42.2,-62.7,-59.3,-49.9,-69.5C-37,-79.7,-18.5,-83,-4,-77.5C10.5,-72,20.9,-57.6,32.5,-47Z;M35.2,-42.2C50.1,-37.7,69.7,-33.3,77.1,-22.3C84.5,-11.2,79.8,6.6,74,23.9C68.2,41.2,61.3,58.1,48.8,66.1C36.3,74.2,18.1,73.5,1.3,71.7C-15.6,70,-31.1,67.1,-45.1,59.5C-59.2,52,-71.6,39.6,-79,24C-86.5,8.3,-88.9,-10.7,-83.2,-26.7C-77.6,-42.7,-63.8,-55.8,-48.6,-60.1C-33.3,-64.5,-16.7,-60.2,-3.2,-55.7C10.2,-51.3,20.4,-46.6,35.2,-42.2Z;M43.5,-57C59.2,-48.4,76.9,-39.6,81.4,-26.3C85.8,-13.1,77,4.5,66.4,16.8C55.8,29.1,43.5,36,32.1,47C20.8,58.1,10.4,73.2,-0.4,73.8C-11.2,74.3,-22.3,60.2,-37.2,50.3C-52.1,40.4,-70.7,34.7,-73.3,24.4C-75.8,14.1,-62.3,-0.9,-55.3,-16.6C-48.3,-32.3,-47.8,-48.7,-39.7,-59.8C-31.6,-70.9,-15.8,-76.7,-1,-75.3C13.8,-74,27.7,-65.6,43.5,-57Z;M31.9,-43C43.4,-35.5,56.3,-29,64,-17.9C71.6,-6.7,74,9,72,25.9C70,42.8,63.7,60.9,51,72.6C38.2,84.3,19.1,89.6,0.1,89.4C-18.8,89.2,-37.6,83.5,-52.5,72.5C-67.3,61.5,-78.1,45.2,-79.6,28.7C-81.1,12.2,-73.3,-4.6,-66.7,-20.6C-60,-36.7,-54.6,-52.2,-43.7,-60C-32.8,-67.7,-16.4,-67.8,-3.1,-63.6C10.2,-59.3,20.3,-50.6,31.9,-43Z;M32.5,-47C44,-36.3,56.6,-29.4,63,-18.4C69.4,-7.5,69.5,7.6,63.6,19.1C57.8,30.7,45.9,38.7,34.2,50.9C22.6,63.2,11.3,79.6,-2.6,83.2C-16.6,86.9,-33.2,77.7,-46.9,66.1C-60.7,54.6,-71.6,40.7,-76.2,25.1C-80.8,9.5,-78.9,-7.8,-74.4,-25C-69.9,-42.2,-62.7,-59.3,-49.9,-69.5C-37,-79.7,-18.5,-83,-4,-77.5C10.5,-72,20.9,-57.6,32.5,-47Z"></animate>
                        </path>
                    </clipPath>
                </svg>
            <!-- This is view -->
            <svg class="eyeCatch" viewBox="0 0 200 200" width="200" height="200">
                    <image preserveAspectRatio="xMidYMid" clip-path="url(#clip)" xlink:href="./img/picture.jpg" width="100%" height="100%"/>
                </svg>
        </div>
        <div class="header-inner-right">
            <h1>アニメーションするSVGで画像をクリップ</h1>
            <p>以下の手順で画像をSVGでクリップしつつ、クリップパスを動かすことができます。</p>
        </div>
    </header>
    <article>
        <section>
            <p class="step" data-num="01">
                まず、

                <a class="link" href="https://www.blobmaker.app/" target="blank">
                    <img src="img/bm-logo.svg" alt="">Blob Maker
                </a>
                のサイトから、2つ以上のblobパスのコードをダウンロードしておきます。(メモ帳等に貼り付けておきます)

            </p>
        </section>
        <section>
            <p class="step" data-num="02">次に、&lt;svg &gt;タグで、html上にクリップパスを作成します。</p>
            <p>
                <a class="link" href="https://www.blobmaker.app/" target="blank">
                    <img src="img/bm-logo.svg" alt="">Blob Maker
                </a>
                のサイトからコピーしたSVGデータをhtmlにペーストして以下のように改変します。

            </p>
            <p class="list-paragraph">
                ・xmlタグ、fill属性は削除
                <br> ・d属性はvalues属性にして切り取る
                <br>・path要素をclipPath要素でマークアップして、idをつける

            </p>
            <pre class="prettyprint linenums lang-html">
<span class="lt">&lt;?xml version="1.0" standalone="no"?&gt;</span>
    &lt;svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"&gt;
        &lt;clipPath id="cp01"&gt;←追加
            &lt;path <span class="lt">fill="#FF0066"</span> <span class="lt">d="</span>→valuesに変更して切り取っておく→<span class="dotted">values="M32.5,-47C44,-36.3,56.6,-29.4,63,-18.4C69.4,-7.5,69.5,7.6,63.6,19.1C57.8,30.7,45.9,38.7,34.2,50.9C22.6,63.2,11.3,79.6,-2.6,83.2C-16.6,86.9,-33.2,77.7,-46.9,66.1C-60.7,54.6,-71.6,40.7,-76.2,25.1C-80.8,9.5,-78.9,-7.8,-74.4,-25C-69.9,-42.2,-62.7,-59.3,-49.9,-69.5C-37,-79.7,-18.5,-83,-4,-77.5C10.5,-72,20.9,-57.6,32.5,-47Z</span>" transform="translate(100 100)" /&gt;
        &lt;/clipPath &gt;
    &lt;/svg &gt;
</pre>
        </section>
        <section>
            <p class="step" data-num="03">記述したクリップパス用のsvgのpath要素内に、animateタグを作り、先ほど切り取ったvalues属性を貼り付けます。さらに以下の属性を加えます。それぞれの属性の意味は以下の通りです。</p>
            <p>最初にblob makerのサイトからコピーしておいたsvgのコードの内、他のd属性の値をコピーしてvalues属性の中に;で区切って追加します。最後のパスはループさせるために最初のパスと合わせます。</p>
            <p class="list-paragraph">
                ・dur="秒数"...アニメーション時間
                <br> ・attributeName="d"...アニメーションの対象となる属性の名前です。ここでは d属性（パス）に動きをつける指定です
                <br> ・repeatCount="indefinite"...繰り返しの指定。indefinte(未定義)で無限繰り返しです
                <br>・values="パス1;パス2;パス3;....パス1;"...svgのd属性の中身のパス文字列をここに貼り付けます。動かすパスを;で区切って指定します。何個書いてもいいですが、ループさせるために最初に指定するパスと最後に指定するパスは同じものにしておきます。

            </p>
            <pre class="prettyprint linenums lang-html">
&lt;svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg &gt;
    &lt;clipPath id="cp01"&gt;
        &lt;path transform="translate(100,100)"&gt;
            &lt;animate values="M55,-47.8C71.1,-39...;M38.6,-44.2C4...; M55,-47.8C...;" dur="3s" attributeName="d" repeatCount="indefinte"&gt;
            &lt;/animate &gt;
        &lt;/path&gt;
    &lt;/clipPath &gt;
&lt;/svg>
</pre>
        </section>
        <section>
            <p class="step" data-num="04">
                このパスは画像をクリップするために使うだけなので、position:absolute指定と幅0、高さ0の指定をして隠しておきます。 （
                <br>
                <img src="img/warn.svg" alt="">:display:noneではダメです）

            </p>
            <pre class="prettyprint linenums lang-css">
svg:has(clipPath){
    position:absolute;
    width:100%;
    height:100%;
    pointer-events:none;
}
<small>※2024年6月現在で:hasのブラウザサポート状況はまだ狭いのでクラス名をつけて指定した方が無難です</small>
</pre>
        </section>
        <section>
            <p class="step" data-num="05">新たにsvgタグを作成し、image要素を使用して画像を埋め込みます。 このsvgにここまでで作ったアニメーションクリップパスを適用します。
            </p>
            <p class="list-paragraph">
                ・ &lt;svg &gt;要素のviewBoxの値はクリップパスのものと合わせます
                <br> ・ &lt;svg &gt;のwidth属性とheight属性もviewboxの後ろの2つの数値と合わせます
                <br> ・ &lt;image &gt;&lt;/image &gt;要素につける属性は以下のものです
                <br> ・xlink:href="画像のファイルパスを指定"
                <br> ・clip-path="url(#クリップパスのid名)"
                <br> ・preserveAspectRatio="xMidYMid"...画像のアスペクト比の固定の方法を指定します。
                <br>・width属性、height属性をそれぞれ100%に指定します

            </p>
            <pre class="prettyprint linenums lang-html">
&lt;svg viewBox="0 0 200 200" width="200" height="200"&gt;
    &lt;path &gt;
        &lt;image xlink:href="画像のパス" clip-path="url(#cp01)" preserveAspectRatio="xMidYMid"&gt;
        &lt;/image &gt;
    &lt;/path &gt;
&lt;/svg &gt;
</pre>
            <p>上記の設定で動くSVGで画像をクリッピングすることができます。</p>
        </section>
        <section>
            <p>以下はコードの全体像です</p>
            <!-- code from here -->
            <pre class="prettyprint linenums all-code">
<style>
    .hide {
        position: absolute;
        width: 0;
        height: 0;
        pointer-events: none;
    }
</style>
<svg class="hide" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
    <clipPath id="cp">
        <path transform="translate(100 100)">
            <animate dur="6s" repeatCount="indefinite" attributeName="d" attributeType="XML" values="M55,-47.8C71.1,-39...;M38.6,-44.2C4...; M55,-47.8C...;"></animate>
        </path>
    </clipPath>
</svg>
<svg width="200" height="200" viewBox="0 0 200 200" class="blob-image">
    <image xlink:href="https://picsum.photos/1500/1500?random=1" width="100%" height="100%" preserveAspectRatio="xMidYMid" clip-path="url(#cp)"/>
</svg>
                </pre>
            <div class="appendix">
                <style>
                    .appendix p {
                        line-height: 1.8;
                    }
                    
                    span.color-yellow *,
                    span.color-yellow {
                        color: yellow !important;
                    }
                </style>
                <h2>追記（2024.06.17）</h2>
                <p>「クリップパスにするパスはposition:absolute;やwidth:0などをつけて非表示にしておくようにする」という説明を書きましたが、&lt;clipPath&gt;要素の部分を<span class="color-yellow">&lt;defs&gt;</span>（definitions）タグで囲めば、外部で使うように再利用領域として定義してブラウザには表示しないようにしておけるようです。<br>これで、&lt;image&gt;タグもまとめて一つのsvgタグ内に収めることができます。</p>
                <p>更にこのコードを記述したテキストファイルを.svg拡張子をつけて保存することで、独立したSMILとして保管できます。</p>
                <p><small>（※ ただしその際には、以下のように<span class="color-yellow">svgタグにxmlns(xml nama space)の記述をする</span>必要があります。）</small></p>
                <pre class="prettyprint linenums lang-html">
&lt;svg viewBox="0 0 200 200" <span class="color-yellow">xlmns="http://www.w3.org/2000/svg" xlmns:xlink="http://www.w3.org/1999/xlink"&gt;</span>
    <span class="color-yellow">&lt;defs&gt;</span>
        &lt;clipPath id="cp001"&gt;
            &lt;path style="transform:translate(50%,50%)"&gt;
                &lt;animate dur="6s" repeatCount="indefinite" attributeName="d" values="M55,-47.8C71.1,-39...;M38.6,-44.2C4...; M55,-47.8C...;"&gt;
                &lt;/animate&gt;
            &lt;/path&gt;
        &lt;/clipPath&gt;
    <span class="color-yellow">&lt;/defs&gt;</span>
    &lt;image xlink:href="https://picsum.photos/500/500?random=1" clip-path="url(#cp001)" preserveAspectRatio="xMidYMid slice" width="100%"" height="100%"&gt;&lt;/image&gt;
&lt;/svg&gt;
</pre>
            </div>
        </section>

        <aside>
            <h2>
                <i class="fa-solid fa-bezier-curve"></i> SMIL Makerつくりました！
            </h2>
            <p>SVGと画像をアップロードするだけで動くクリップSVG（SMIL）を作れるWebアプリを公開しました。以下のリンクから開くことができます。</p>
            <p>
                <a href="smilmaker/app.html" target="blank">SMIL Maker</a>
            </p>
        </aside>
    </article>
    <footer>
        <small>
                Copyright &copy;Katsuyori Murakami Flashmelody <img src="img/FlashMelodylogo_red_circle.svg">2024 All Rights Reserved.
            </small>
    </footer>
    <!-- code to here -->
    <!--jQeury-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?skin=sunburst&lang=css&lang=html"></script>
    <script>
        let currentHTML = $(".all-code").html();
        let altHTML = currentHTML.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        $(".all-code").html(altHTML);
        $(".step").each((index, elem) => {
            let num = $(elem).data("num");
            let newSpan = $("<span>");
            newSpan[0].innerText = num;
            newSpan.addClass("number");
            newSpan.prependTo($(elem));
        })
    </script>
</body>

</html>